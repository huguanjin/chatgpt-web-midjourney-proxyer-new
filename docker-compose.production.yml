# ============================================================
# 生产部署用 docker-compose（使用 GitHub Container Registry 预构建镜像）
# 
# 使用方式：
#   1. 将此文件和 .env 复制到服务器任意目录
#   2. 编辑 .env 中的配置
#   3. docker compose -f docker-compose.production.yml up -d
#
# 更新镜像：
#   docker compose -f docker-compose.production.yml pull
#   docker compose -f docker-compose.production.yml up -d
# ============================================================

services:
  # ============ 后端 API ============
  api:
    image: ghcr.io/huguanjin/ai-creator-api:latest
    container_name: ai-creator-api
    restart: unless-stopped
    network_mode: host
    environment:
      PORT: 3003
      NODE_ENV: production
      # 宿主机网络模式，直接用 127.0.0.1 连接 MongoDB
      MONGODB_URI: mongodb://127.0.0.1:27017/
      MONGODB_DATABASE: PPTTOVideo
      TZ: Asia/Shanghai
    volumes:
      # 上传文件持久化
      - /opt/ai-creator/uploads:/app/uploads

  # ============ 前端 Web ============
  web:
    image: ghcr.io/huguanjin/ai-creator-web:latest
    container_name: ai-creator-web
    restart: unless-stopped
    network_mode: host
    depends_on:
      - api
